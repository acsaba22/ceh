#!/bin/bash -e

. /opt/ceh/scripts/common-functions.sh

# This is a 32-bit FF install (working on both amd64 and i686) with
# all the 3 required plugins:
#  - google talk,
#  - java,
#  - flash,
# please make sure to remove all the conflicting plugins from your
# system (~/.mozilla/firefox/plugins, /usr/lib/mozilla, etc.).
#
# To make sure everything is OK, use all 3 plugins while running
# firefox from a terminal and watch stderr.
#
# Do not ever mix 64-bit plugins with this 32-bit firefox!

# To enable google talk plugin and jre plugin.
export NIXPKGS_CONFIG=/opt/ceh/nix-configs/firefox.nix

ceh_nixpkgs_install firefox17Wrapper 1.0pre22969_d068aa9 \
    wc2lqwvbrycmjzj8ycw72sc8k9g80468-firefox-17.0.1-with-plugins.drv \
    m35rh488kzb2cdcak89pqnmwl4rqsq53-firefox-17.0.1-with-plugins

# TODO(errge): maybe general alsa support in common-functions.sh?
# This is needed for cases when the user has a ~/.asoundrc that uses
# modules (e.g. redirects everything through pulseaudio).
ceh_nixpkgs_install alsaPlugins 1.0pre22969_d068aa9 \
    raz8xvrrmnb8whj05h7x0sj2vjqi8f2g-alsa-plugins-1.0.26.drv \
    gd2g1g0znz3kqsvjlamandg6lx99i0xc-alsa-plugins-1.0.26
export ALSA_PLUGIN_DIRS=/nix/store/gd2g1g0znz3kqsvjlamandg6lx99i0xc-alsa-plugins-1.0.26/lib/alsa-lib

exec /nix/store/m35rh488kzb2cdcak89pqnmwl4rqsq53-firefox-17.0.1-with-plugins/bin/firefox "$@"
