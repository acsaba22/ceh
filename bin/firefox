#!/opt/ceh/lib/perl
# -*- mode: perl; -*-

use strict;
use warnings;
use lib "/opt/ceh/lib";
use CehInstall;

# This is a 32-bit FF install (working on both amd64 and i686) with
# all the 3 required plugins:
#  - google talk,
#  - java,
#  - flash,
# please make sure to remove all the conflicting plugins from your
# system (~/.mozilla/firefox/plugins, /usr/lib/mozilla, etc.).
#
# To make sure everything is OK, use all 3 plugins while running
# firefox from a terminal and watch stderr.
#
# Do not ever mix 64-bit plugins with this 32-bit firefox!
# TODO(errge): an ld_preload hack that purifies this plugin issue, by
# hiding /usr/lib/mozilla, ~/.mozilla/plugins and whatever else that
# is needed.

# This is needed for cases when the user has a ~/.asoundrc that uses
# modules (e.g. redirects everything through pulseaudio).
ceh_nixpkgs_install('alsaPlugins', nixpkgs_version => 'd82d86eb64b159cc821261ec31c528cf97a68382', derivation => '6zc8yg58l2d2mxl4n2wi2qgwk0vm5gjp-alsa-plugins-1.0.26.drv', out => 'gq02aq0yj2p4n4flz9002b8kmzj4h5kg-alsa-plugins-1.0.26');
$ENV{ALSA_PLUGIN_DIRS}="$ceh_nix_install_root/lib/alsa-lib";

# To enable google talk plugin and jre plugin.
$ENV{NIXPKGS_CONFIG}="/opt/ceh/lib/Packages/firefox.nix";
ceh_nixpkgs_install('firefox20Wrapper', nixpkgs_version => 'd82d86eb64b159cc821261ec31c528cf97a68382', derivation => 'q5hvaw146vwfcw6wyq2r7s7hr5fh1r5f-firefox-20.0-with-plugins.drv', out => 'kll98ap3rcvxd557pq2srns2ym5wdm57-firefox-20.0-with-plugins');

exec "$ceh_nix_install_root/bin/firefox", @ARGV;


